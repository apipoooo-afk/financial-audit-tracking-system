<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• / ‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Data Hub) ‚Ä¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (FA) ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</title>

  <style>
    :root{
      --bg:#f4f7fb; --card:#fff; --line:#dde5f2; --text:#24364c; --muted:#6a7f9a;
      --brand:#1e5aaa; --brand2:#2f7de1;
      --shadow:0 10px 28px rgba(20,40,80,.08);
      --r:18px;
      --ok:#1f7a3b; --bad:#b13b3b; --warn:#8a5a00; --info:#0b5aa6;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans Thai","Noto Sans";background:var(--bg);color:var(--text)}
    header{
      position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--line);
      padding:14px 18px;display:flex;align-items:center;gap:12px
    }
    .title{display:flex;flex-direction:column;line-height:1.05}
    .title h1{margin:0;font-size:18px}
    .title small{color:var(--muted)}
    .spacer{flex:1}
    .badge{border:1px solid #cfe2ff;background:#eef6ff;color:#1e5aaa;padding:8px 12px;border-radius:14px;font-weight:900}

    .wrap{max-width:1200px;margin:18px auto;padding:0 18px}
    .grid{
      display:grid;gap:12px;
      grid-template-columns:repeat(12,1fr);
    }
    .card{
      grid-column:span 12;
      background:var(--card);border:1px solid var(--line);border-radius:var(--r);
      box-shadow:var(--shadow);padding:14px;min-width:0
    }
    @media(min-width:900px){
      .col6{grid-column:span 6}
      .col4{grid-column:span 4}
      .col8{grid-column:span 8}
    }

    h2{margin:0 0 8px;font-size:16px}
    h3{margin:0 0 6px;font-size:14px}
    .muted{color:var(--muted);font-size:13px}
    .hr{height:1px;background:#eef2f7;margin:12px 0}

    .btn{
      width:100%;
      border:1px solid var(--line); background:#fff; border-radius:14px;
      padding:12px 12px; cursor:pointer; font-weight:900; color:var(--text);
      text-align:left
    }
    .btn.primary{background:linear-gradient(90deg,var(--brand),var(--brand2));color:#fff;border-color:transparent}
    .btn:disabled{opacity:.55;cursor:not-allowed}

    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row>*{flex:1;min-width:190px}

    .pill{display:inline-block;padding:6px 10px;border-radius:999px;font-weight:900;font-size:12px;border:1px solid #cfe2ff;background:#eef6ff;color:#1e5aaa}
    .pill.ok{border-color:#c8f2d6;background:#effaf3;color:var(--ok)}
    .pill.warn{border-color:#ffe7b8;background:#fff7e6;color:var(--warn)}
    .pill.bad{border-color:#ffd2d2;background:#fff0f0;color:var(--bad)}
    .pill.info{border-color:#cfe2ff;background:#eef6ff;color:var(--info)}

    .kpi{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    .kpi .box{border:1px solid var(--line);border-radius:16px;padding:12px;background:#fff}
    .kpi .box b{font-size:18px}
    .tiny{font-size:12px;color:var(--muted)}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}

    .msg{display:none;margin-top:10px;padding:10px 12px;border-radius:14px;font-weight:900}
    .okBox{border:1px solid #c8f2d6;background:#effaf3;color:var(--ok)}
    .badBox{border:1px solid #ffd2d2;background:#fff0f0;color:var(--bad)}
    .warnBox{border:1px solid #ffe7b8;background:#fff7e6;color:var(--warn)}
  </style>
</head>

<body>
<header>
  <div class="title">
    <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• / ‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Data Hub)</h1>
    <small>‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°: ‡∏Ñ‡∏•‡∏±‡∏á‡πÑ‡∏ü‡∏•‡πå Upload + ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Manual + ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ + Export + ‡∏ó‡∏≤‡∏á‡∏•‡∏±‡∏î‡πÑ‡∏õ Cashboard</small>
  </div>
  <div class="spacer"></div>
  <div class="badge" id="userBadge">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‚Ä¶</div>
</header>

<div class="wrap">
  <div class="grid">

    <div class="card col8">
      <h2>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)</h2>
      <div class="muted">‡πÉ‡∏ä‡πâ localStorage ‡πÄ‡∏õ‡πá‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡πâ‡∏ô‡πÅ‡∏ö‡∏ö/POC) ‚Ä¢ ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á</div>

      <div class="hr"></div>

      <div class="kpi">
        <div class="box">
          <div class="tiny">Manual Records (‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö)</div>
          <b id="kManual">0</b>
        </div>
        <div class="box">
          <div class="tiny">‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß (Submitted)</div>
          <b id="kSubmitted">0</b>
        </div>
        <div class="box">
          <div class="tiny">Locked (>=356 ‡∏ß‡∏±‡∏ô)</div>
          <b id="kLocked">0</b>
        </div>
        <div class="box">
          <div class="tiny">Upload Files (‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö)</div>
          <b id="kFiles">0</b>
        </div>
      </div>

      <div class="hr"></div>

      <div class="row">
        <button class="btn primary" id="goCashboard">‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Cashboard (‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° 2.1.7‚Äì2.1.20)</button>
        <button class="btn" id="goHome">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
      </div>

      <div class="msg okBox" id="ok"></div>
      <div class="msg warnBox" id="warn"></div>
      <div class="msg badBox" id="bad"></div>
    </div>

    <div class="card col4">
      <h2>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ Admin</h2>
      <div class="muted">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á ‚Äú‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Äù ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
      <div class="hr"></div>

      <button class="btn" id="goUpload">
        üì¶ ‡∏Ñ‡∏•‡∏±‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å Upload
        <div class="tiny">‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå/‡∏Ç‡∏ô‡∏≤‡∏î/‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡∏ú‡∏π‡πâ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î ‚Ä¢ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î ‚Ä¢ Export ‚Ä¢ ‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Tag</div>
      </button>

      <div style="height:10px"></div>

      <button class="btn" id="goManualTable">
        üßæ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Manual Data (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Excel)
        <div class="tiny">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Ä¢ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö/Export ‚Ä¢ ‡πÄ‡∏Ñ‡∏≤‡∏£‡∏û‡∏•‡πá‡∏≠‡∏Å 356 ‡∏ß‡∏±‡∏ô</div>
      </button>

      <div style="height:10px"></div>

      <button class="btn" id="goManualSearch">
        üîé ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Manual Data (2.2)
        <div class="tiny">‡∏Ñ‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ‡∏á‡∏ö‡∏Ø / ‡∏´‡∏ô‡πà‡∏ß‡∏¢ / ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà / keyword ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (2.3)</div>
      </button>

      <div style="height:10px"></div>

      <button class="btn" id="goManualEntry">
        ‚úçÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Manual (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)
        <div class="tiny">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Admin)</div>
      </button>

      <div style="height:10px"></div>

      <button class="btn" id="goAdminMenu">
        üßë‚Äçüíº ‡πÄ‡∏°‡∏ô‡∏π Admin (‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á Admin)
        <div class="tiny">‡∏£‡∏ß‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</div>
      </button>

      <div class="hr"></div>

      <button class="btn" id="btnExportAll">
        ‚¨áÔ∏è Export ‚Äú‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‚Äù (Manual+Uploads) ‡πÄ‡∏õ‡πá‡∏ô JSON
        <div class="tiny">‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</div>
      </button>

      <div style="height:10px"></div>

      <button class="btn" id="btnImportAll">
        ‚¨ÜÔ∏è Import ‚Äú‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‚Äù ‡∏à‡∏≤‡∏Å JSON
        <div class="tiny">‡πÉ‡∏ä‡πâ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏à‡∏∞ merge ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ö id ‡πÄ‡∏î‡∏¥‡∏°)</div>
      </button>
      <input id="importFile" type="file" accept="application/json" style="display:none" />
    </div>

    <div class="card">
      <h2>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö (Tech Notes)</h2>
      <div class="muted">
        ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß: <span class="pill info mono">localStorage</span> ‚Ä¢
        Key Manual: <span class="pill info mono">fa_manual_records_v1</span> ‚Ä¢
        Key Upload: <span class="pill info mono">fa_upload_files_v1</span>
      </div>
      <div class="hr"></div>
      <div class="muted">
        ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á/‡∏´‡∏•‡∏≤‡∏¢‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á (PostgreSQL) + Auth ‡∏à‡∏£‡∏¥‡∏á (JWT) + Audit Log ‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
      </div>
    </div>

  </div>
</div>

<script>
/* =========================
   Guard: login + ADMIN
   ========================= */
const SESSION_KEY = "fa_session_v1";
const session = JSON.parse(localStorage.getItem(SESSION_KEY) || "null");
if(!session){ location.href="login.html"; }
const role = (session.role || "USER").toUpperCase();
if(role !== "ADMIN"){
  alert("‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö (ADMIN) ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");
  location.href="index.html";
}
document.getElementById("userBadge").textContent =
  "‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: " + (session.fullname || session.username) + " ‚Ä¢ ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: " + role;

/* =========================
   Storage keys
   ========================= */
const MANUAL_KEY = "fa_manual_records_v1";
const UPLOAD_KEY = "fa_upload_files_v1";

/* =========================
   Helpers
   ========================= */
const $ = (id)=>document.getElementById(id);
function show(box, text){
  const el = $(box);
  el.textContent = text;
  el.style.display="block";
  setTimeout(()=>el.style.display="none", 2500);
}
function getJSON(key){ return JSON.parse(localStorage.getItem(key) || "[]"); }
function isLocked(created_at){
  if(!created_at) return false;
  const days = (Date.now() - created_at)/86400000;
  return days >= 356;
}
function downloadText(filename, text, mime="application/json"){
  const blob = new Blob([text], {type:mime});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href=url; a.download=filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(()=>URL.revokeObjectURL(url), 1000);
}

/* =========================
   KPIs
   ========================= */
function refreshKPI(){
  const manual = getJSON(MANUAL_KEY).filter(x=>!x.deleted);
  const uploads = getJSON(UPLOAD_KEY).filter(x=>!x.deleted);

  const submitted = manual.filter(x=>!!x.submitted).length;
  const locked = manual.filter(x=>isLocked(x.created_at)).length;

  $("kManual").textContent = manual.length;
  $("kSubmitted").textContent = submitted;
  $("kLocked").textContent = locked;
  $("kFiles").textContent = uploads.length;
}
refreshKPI();

/* =========================
   Navigation
   ========================= */
$("goCashboard").addEventListener("click", ()=>location.href="cashboard.html");
$("goHome").addEventListener("click", ()=>location.href="index.html");

$("goUpload").addEventListener("click", ()=>location.href="admin-upload-files.html");
$("goManualTable").addEventListener("click", ()=>location.href="admin-manual-table.html");
$("goManualSearch").addEventListener("click", ()=>location.href="admin-manual-search.html");
$("goManualEntry").addEventListener("click", ()=>location.href="manual-entry.html");
$("goAdminMenu").addEventListener("click", ()=>location.href="admin.html");

/* =========================
   Export/Import all system
   ========================= */
$("btnExportAll").addEventListener("click", ()=>{
  const payload = {
    exported_at: Date.now(),
    exported_by: (session.fullname || session.username),
    manual_records: getJSON(MANUAL_KEY),
    upload_files: getJSON(UPLOAD_KEY)
  };
  downloadText(`fa_datahub_backup_${Date.now()}.json`, JSON.stringify(payload,null,2), "application/json");
  show("ok","Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ");
});

$("btnImportAll").addEventListener("click", ()=>$("importFile").click());

$("importFile").addEventListener("change", async ()=>{
  const f = $("importFile").files?.[0];
  if(!f) return;

  try{
    const text = await f.text();
    const payload = JSON.parse(text);

    const inManual = Array.isArray(payload.manual_records) ? payload.manual_records : [];
    const inUpload = Array.isArray(payload.upload_files) ? payload.upload_files : [];

    const curManual = getJSON(MANUAL_KEY);
    const curUpload = getJSON(UPLOAD_KEY);

    const mIds = new Set(curManual.map(x=>x.id));
    const uIds = new Set(curUpload.map(x=>x.id));

    // merge only if id not exists
    const addManual = inManual.filter(x=>x && x.id && !mIds.has(x.id));
    const addUpload = inUpload.filter(x=>x && x.id && !uIds.has(x.id));

    localStorage.setItem(MANUAL_KEY, JSON.stringify(curManual.concat(addManual)));
    localStorage.setItem(UPLOAD_KEY, JSON.stringify(curUpload.concat(addUpload)));

    show("ok", `Import ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° Manual ${addManual.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‚Ä¢ Upload ${addUpload.length} ‡πÑ‡∏ü‡∏•‡πå`);
    $("importFile").value="";
    refreshKPI();
  }catch(err){
    show("bad", "Import ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
  }
});
</script>
</body>
</html>